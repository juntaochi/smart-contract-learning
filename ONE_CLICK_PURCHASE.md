# 🎯 NFT 白名单一键购买功能

## ✅ 已添加功能

在 NFT Whitelist 页面添加了 **自动签名并购买** 功能！

### 使用方法

1. **访问页面**

   ```
   http://localhost:3000/nft-whitelist
   ```

2. **连接钱包**
   - 使用有 JAC 代币的地址：`0x5D26552Fe617460250e68e737F2A60eA6402eEA9`

3. **点击绿色按钮**

   ```
   🚀 自动签名并购买 NFT
   ```

4. **完成！**
   - 系统会自动：
     1. 为你的地址生成 EIP-712 白名单签名
     2. 请求签名授权（钱包弹窗 - 免费）
     3. 授权 100 JAC 代币（第一笔交易）
     4. 购买 NFT #0（第二笔交易）

## 🔍 工作原理

### EIP-712 签名生成

```typescript
// 自动构建 EIP-712 签名数据
const domain = {
  name: 'NFTMarket',
  version: '1',
  chainId: 11155111,  // Sepolia
  verifyingContract: NFT_MARKET_ADDRESS
}

const message = {
  buyer: address,           // 你的地址
  nftContract: JAC_NFT,     // NFT 合约地址
  tokenId: 0,               // 自动设置为 0
  nonce: currentNonce,      // 从合约读取
  deadline: now + 10 hours  // 10小时有效期
}

// 请求钱包签名
const signature = await walletClient.signTypedData(...)
```

### 购买流程

1. **签名** - 在钱包中签名白名单消息（免费，不发交易）
2. **授权** - Approve 100 JAC 给 NFTMarket 合约
3. **购买** - 调用 `permitBuy` 函数，使用签名验证并购买

## 📊 页面功能

### 自动模式（推荐）

- 🚀 **绿色按钮**：一键完成所有操作
- 自动填充 Token ID = 0
- 自动生成签名
- 自动执行购买

### 手动模式

如果需要手动测试，可以：

1. 输入 NFT Token ID
2. 粘贴项目方提供的签名
3. 点击 "🎨 Purchase NFT"

## ⚠️ 注意事项

### 测试环境专用

- 此自动签名功能 **仅用于测试**
- 生产环境应该由后端生成签名
- 永远不要在前端暴露项目方私钥

### 安全说明

```
⚠️ 注意：在生产环境中，签名应该由后端生成！
这里的自动签名是让连接的钱包为自己签名，
仅适用于测试环境快速验证功能。
```

## 🎨 UI 改进

- **绿色高亮区域** - 测试模式一键购买
- **明确的分隔线** - 区分自动和手动模式
- **详细的提示** - 解释每个步骤
- **实时状态** - 显示 nonce 和余额

## 🧪 测试步骤

1. 使用 `0x5D26552Fe617460250e68e737F2A60eA6402eEA9` 连接钱包
2. 确认有足够的 JAC 代币（应该有 10M）
3. 点击绿色按钮
4. 在钱包中签名消息（免费）
5. 确认授权交易
6. 确认购买交易
7. ✅ NFT #0 到手！

---

刷新页面即可看到新功能！🎉
